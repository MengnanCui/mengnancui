<!doctype html><html>
<head>
<title>
:: My blog
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name=revised content="2021-12-19T12:51:42 UTC">
<meta name=description content>
<title> :: My blog</title>
<link rel="shortcut icon" href=/mengnancui/images/favicon.png type=image/x-icon>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css>
<script src=https://code.jquery.com/jquery-3.5.1.min.js></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/sass/layout.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/css/style.main.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/css/style.menu.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/sass/shortcodes/notice.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/sass/shortcodes/tabs.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/sass/shortcodes/panel.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/sass/shortcodes/columns.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/sass/shortcodes/children.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/sass/shortcodes/attachments.css>
<link rel=stylesheet type=text/css href=https://mengnancui.github.io/mengnancui/sass/shortcodes/alert.css>
<link rel=stylesheet type=text/css href=/mengnancui/css/docport.css>
<script src=/mengnancui/js/docport.js></script>
<script type=text/javascript>var baseurl="https://mengnancui.github.io/mengnancui/"</script>
</head>
<body data-url=/mengnancui/flare/>
<style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style>
<header>
<div>
<div class=burger>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">&#9776;</a>
</div>
<div>
<a class=baselink href=https://mengnancui.github.io/mengnancui/>My blog</a>
</div>
</div>
</header>
<article>
<aside>
<div class=search>
<div class=searchbox>
<input data-search-input id=search-by type=text placeholder="Type to search...">
</div>
<script type=text/javascript src=/mengnancui/vendor/lunr/lunr.min.js></script>
<script type=text/javascript src=/mengnancui/vendor/auto-complete/auto-complete.js></script>
<link href=/mengnancui/vendor/auto-complete/auto-complete.css rel=stylesheet>
<script type=text/javascript>var baseurl="https://mengnancui.github.io/mengnancui/"</script>
<script type=text/javascript src=/mengnancui/js/search.js></script>
</div>
<div id=close_menu>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">
<i class="fa fa-lg fa-times"></i>
</a>
</div>
<ul class=menu>
</ul>
</aside>
<section class=page>
<nav id=ariane aria-label=breadcrumb>
<ol class=ariane>
<li>
<a class=text-link href=https://mengnancui.github.io/mengnancui/>
Home
</a>
</li>
<li class=active>
</li>
</ol>
</nav>
<h1>My blog<span>flare</span></h1>
<nav class=subpages>
<li>
<a title=$pagetitle href=/mengnancui/first-blog/>First Blog</a>
</li>
<li class=active>
<a title=$pagetitle href=/mengnancui/flare/>flare</a>
</li>
</nav>
<div class=jump-to-section>
<span onclick="$h=$(this),$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right'})})">
<span class="fas fa-align-right"></span>
Jump to Section
<i class="fas fa-chevron-right"></i>
</span>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#1-objectives->1. Objectives:** **</a></li>
<li><a href=#2-installation>2. Installation</a></li>
<li><a href=#3-first-trial>3. First trial</a></li>
<li><a href=#4-learning-curve>4. Learning curve</a></li>
<li><a href=#5-toward-large-scale-applications-pdag>5. Toward large scale applications: Pd/Ag</a></li>
</ul>
</li>
</ul>
<ul>
<li>
<ul>
<li><a href=#1-date-from-ase>1. Date from ase</a></li>
</ul>
</li>
</ul>
<ul>
<li>
<ul>
<li><a href=#1-setting-up-a-gaussain-process-object>1. Setting up a Gaussain Process Object</a></li>
<li><a href=#2-extracting-the-frames-from-a-previous-aimd-runoptional>2. Extracting the Frames from a previous AIMD run(Optional)</a></li>
<li><a href=#3-training-your-gaussian-process>3. Training your Gaussian Process</a></li>
</ul>
</li>
</ul>
<ul>
<li>
<ul>
<li><a href=#1-set-up-supercell-with-ase>1. Set up supercell with ASE</a></li>
<li><a href=#2-set-up-flare-calculator>2. Set up FLARE calculator</a></li>
<li><a href=#3-set-up-dft-calculator>3. Set up DFT calculator</a></li>
<li><a href=#4-set-up-on-the-fly-md-engine>4. Set up On-The-Fly MD engine</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div class=content>
<h1 ref=flare-fast-learning-of-atomistic-rare-eventsfor-0-to-xxmd>FLARE: Fast Learning of Atomistic Rare Events(for 0 to xx).md</h1><a class=anchor id=flare-fast-learning-of-atomistic-rare-eventsfor-0-to-xxmd></a>
<blockquote>
<p>Jonathan Vandermause (<a href=mailto:jonathan_vandermause%40g.harvard.edu>jonathan_vandermause@g.harvard.edu</a>)</p>
</blockquote>
<p>Not theory involved below!</p>
<p>[toc]</p>
<h1 ref=1--introduction>1. Introduction</h1><a class=anchor id=1--introduction></a>
<h3 ref=1-objectives->1. Objectives:** **</h3><a class=anchor id=1-objectives-></a>
<p>**Train 2+3-body Gaussian process models on <em><strong><strong>ab initio</strong></strong></em> force data. **</p>
<ul>
<li>Open-source</li>
<li>Bayesian machine learning (Gaussian Process)</li>
<li>Training fast potentials on accurate DFT data</li>
</ul>
<p><img src=images/1ocZtyAphDX6___gBCOrW7J_79mjw3oWFg-kCIucdHo.png alt=image></p>
<h3 ref=2-installation>2. Installation</h3><a class=anchor id=2-installation></a>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#960050;background-color:#1e0010>!</span>pip install <span style=color:#f92672>--</span>upgrade mir<span style=color:#f92672>-</span>flare

<span style=color:#75715e># for flare++</span>
<span style=color:#960050;background-color:#1e0010>!</span>pip install <span style=color:#f92672>--</span>upgrade flare_pp

<span style=color:#75715e># However, the automatically process failed in my laptop, so I have to install it manually:</span>
git clone https:<span style=color:#f92672>//</span>github<span style=color:#f92672>.</span>com<span style=color:#f92672>/</span>mir<span style=color:#f92672>-</span>group<span style=color:#f92672>/</span>flare_pp<span style=color:#f92672>.</span>git
cd flare_pp<span style=color:#f92672>/</span>
python setup<span style=color:#f92672>.</span>py install
<span style=color:#75715e># Work!</span>
</code></pre></div><h4 ref=import>import</h4><a class=anchor id=import></a>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> flare <span style=color:#f92672>import</span> gp, struc, output, predict, md, otf, env,\
  otf_parser
<span style=color:#f92672>from</span> flare.kernels <span style=color:#f92672>import</span> mc_simple
<span style=color:#f92672>from</span> flare.utils <span style=color:#f92672>import</span> md_helper

<span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
<span style=color:#f92672>import</span> time
<span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
<span style=color:#f92672>import</span> pickle
<span style=color:#f92672>from</span> ase.visualize <span style=color:#f92672>import</span> view
</code></pre></div><h3 ref=3-first-trial>3. First trial</h3><a class=anchor id=3-first-trial></a>
<ul>
<li><strong>build</strong> <code>gp_model = gp.GaussianProcess(parameters...)</code></li>
<li><strong>Input training data:</strong><code>gp_model.update_db(traing_x, traning_y)</code></li>
<li><strong>training:</strong><code>gp_model.set_L_alpha() # update covariance matrix</code></li>
<li>**prediction: **<code>gp_model.likelihood</code></li>
<li>Turning Hyperparameters to improve prediction:
<ul>
<li><code>gp_model.hyps = np.array([0.01, 1, 0.001, 1, 0.2])</code></li>
<li>Correspond: ** Signal variance of the 2-body kernel (in eV) * Length scale of the 2-body kernel (in A) * Signal variance of the 3-body kernel (in eV) * Length scale of the 3-body kernel (in A) * Noise hyperparameter (in eV/A)**</li>
<li>Human words: the hyps are noise level(less than errors scale 0.1eV/A) and length scale 1 A for **2-body **and <strong>3-body</strong>, respecitively.</li>
<li>Optimize these Hyps: <code>gp_model.train(print_progress=True) # gradient descent approach</code></li>
</ul>
</li>
</ul>
<h3 ref=4-learning-curve>4. Learning curve</h3><a class=anchor id=4-learning-curve></a>
<ul>
<li><strong>Optimize</strong> Hyps</li>
<li><strong>Build</strong> <code>gp_model = gp.GaussianProcess(parameters...)</code></li>
<li><strong>Training</strong>: <code>for atom in mole: ; gp_model_update_db(training_x, training_y); gp_model.set_L_alpha()</code></li>
<li><strong>Prediction</strong>: <code>pred_forces, stds = predict.predict_on_structure(validation_structure, gp_model)</code></li>
<li><strong>Calculate</strong> <strong>error</strong>: <code> mse = np.mean(np.abs(pred_forces - validation_forces))</code></li>
<li><strong>Save</strong> data: <strong>MSE</strong>, <strong>Time</strong>, <strong>number</strong> <strong>of</strong> <strong>atomic</strong> <strong>environment</strong>
<ul>
<li><code>validation_errors = np.zeros(n_atoms)</code></li>
<li><code>prediction_times = np.zeros(n_atoms)</code></li>
<li><code>validation_count = 0</code></li>
<li><code>...</code></li>
<li><code>validation_errors[validation_count] = mae</code></li>
<li><code>prediction_times[validation_count] = time1 - time0</code></li>
<li><code>validation_count += 1</code>
注意：每一个原子都是一个environment(而不是a molecular)</li>
</ul>
</li>
<li><strong>Plot</strong>: <code>plt.plot(validation_errors), plt.ylabel(''), plt.xlabel(''), plt.show()</code>
<ul>
<li><code>plt.plot(prediction_times), plt.ylabel(''), plt.xlabel(''), plt.show()</code></li>
<li><strong>valication_errors/prediction_times</strong> are lists contain error value of each atom. Its size equal to number of atoms</li>
</ul>
</li>
</ul>
<p><img src=images/fvvEQr2ncewSap2nknfQ2iRgZ7NzkiV-Nt9Z4nwlMl8.png alt=image></p>
<p><img src=images/cJaIa__ZSCxlFFGiWwDlek3U8OV3PbUqMOw7L0w_smg.png alt=image></p>
<h3 ref=5-toward-large-scale-applications-pdag>5. Toward large scale applications: Pd/Ag</h3><a class=anchor id=5-toward-large-scale-applications-pdag></a>
<ul>
<li>How does palladium dissolve into a silver surface?</li>
<li>Relevant to the selectivity/reactivity tradeoff in bimetallic catalysts</li>
<li>Cool, as we can see below, the FF forces seems really uncertainty!</li>
</ul>
<p><img src=images/gPKPOez9ar-kXNv5HfVXD1OwC19pzFiuvMYt5BH_Htg.png alt=image></p>
<h4 ref=-steps1--set-up-the-initial-structure>* Steps1: Set up the initial structure.</h4><a class=anchor id=-steps1--set-up-the-initial-structure></a>
<h4 ref=-steps2-set-up-a-gp-model>* Steps2: Set up a GP model</h4><a class=anchor id=-steps2-set-up-a-gp-model></a>
<ul>
<li><strong>Build</strong>: <code>gp_model = gp.GaussianProcess(parameters,...)</code></li>
</ul>
<h4 ref=-steps3-set-up-an-otf-training-object>* Steps3: Set up an OTF training object.</h4><a class=anchor id=-steps3-set-up-an-otf-training-object></a>
<ul>
<li><code>otf_model = otf.OTF(parameters, ... ,dft_input = input_file_name)</code></li>
</ul>
<h4 ref=-steps4-perform-the-simulation>* Steps4: Perform the simulation!</h4><a class=anchor id=-steps4-perform-the-simulation></a>
<ul>
<li><code>otf_model.run()</code></li>
</ul>
<h4 ref=-parsing-the-otf-output-file>* Parsing the OTF output file.</h4><a class=anchor id=-parsing-the-otf-output-file></a>
<ul>
<li><code>output_file = 'otf_run.out'</code>
<code>otf_trajectory = otf_parser.OtfAnalysis(output_file)</code></li>
<li>&mldr;</li>
</ul>
<p><img src=images/0UpMty302aISWu4fqa3j67sX5rrDUnUT2Nb3O90CAxw.png alt=image></p>
<h1 ref=2-prepare-data>2. Prepare data</h1><a class=anchor id=2-prepare-data></a>
<h3 ref=1-date-from-ase>1. Date from ase</h3><a class=anchor id=1-date-from-ase></a>
<p>Transfer your data from ase <code>Atoms</code> to <code>Structure.from_ase_atoms()</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> ase.io
<span style=color:#f92672>from</span> flare.struc <span style=color:#f92672>import</span> Structure

frames <span style=color:#f92672>=</span> ase<span style=color:#f92672>.</span>io<span style=color:#f92672>.</span>read(<span style=color:#e6db74>&#39;db.xyz@:&#39;</span>)
trajectory <span style=color:#f92672>=</span> []
<span style=color:#66d9ef>for</span> atoms <span style=color:#f92672>in</span> frames:
    trajectory<span style=color:#f92672>.</span>append(Strucuture<span style=color:#f92672>.</span>from_ase_atoms(atoms))
</code></pre></div><h1 ref=heading></h1><a class=anchor id=heading></a>
<h1 ref=3-training-fisrt-gaussian-process-from-aimd>3. Training fisrt Gaussian process from AIMD</h1><a class=anchor id=3-training-fisrt-gaussian-process-from-aimd></a>
<p><img src=images/vFiv7lRu22yYVbapjIPin8hbUIRZlYp9NEMK2y8rsok.png alt=image></p>
<h3 ref=1-setting-up-a-gaussain-process-object>1. Setting up a Gaussain Process Object</h3><a class=anchor id=1-setting-up-a-gaussain-process-object></a>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> flare.gp <span style=color:#f92672>import</span> GaussianProcess
</code></pre></div><ul>
<li>Important parameters for GP
<ul>
<li><code>kernels=['twobody', 'threebody'] # 2-body and 3-body system</code></li>
<li><code>hyps = [0.01, 0.01, 0.01, 0.01, 0.01] # initial guess hyps(can be optimized later), last hyps is noise variance</code></li>
<li><code>cutoffs = {'twobody':7, 'threebody':3} # cutoff values for 2,3-body, repectively</code></li>
</ul>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>gp <span style=color:#f92672>=</span> GaussianProcess(kernels<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;twobody&#39;</span>, <span style=color:#e6db74>&#39;threebody&#39;</span>],
hyps<span style=color:#f92672>=</span>[<span style=color:#ae81ff>0.01</span>, <span style=color:#ae81ff>0.01</span>, <span style=color:#ae81ff>0.01</span>, <span style=color:#ae81ff>0.01</span>, <span style=color:#ae81ff>0.01</span>],
cutoffs <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;twobody&#39;</span>:<span style=color:#ae81ff>7</span>, <span style=color:#e6db74>&#39;threebody&#39;</span>:<span style=color:#ae81ff>3</span>},
hyp_labels<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;Two-Body Signal Variance&#39;</span>,<span style=color:#e6db74>&#39;Two-Body Length Scale&#39;</span>,<span style=color:#e6db74>&#39;Three-Body Signal Variance&#39;</span>,
<span style=color:#e6db74>&#39;Three-Body Length Scale&#39;</span>, <span style=color:#e6db74>&#39;Noise Variance&#39;</span>])
</code></pre></div><h3 ref=2-extracting-the-frames-from-a-previous-aimd-runoptional>2. Extracting the Frames from a previous AIMD run(Optional)</h3><a class=anchor id=2-extracting-the-frames-from-a-previous-aimd-runoptional></a>
<ul>
<li>I like to use ASE, So just transfer data from ase <code>Atoms</code> to <code>Structure.from_ase_atoms()</code></li>
</ul>
<h3 ref=3-training-your-gaussian-process>3. Training your Gaussian Process</h3><a class=anchor id=3-training-your-gaussian-process></a>
<ul>
<li>Input arguments for training:
<ul>
<li><code>rel_std_tolerance:The length scale for uncertainty expected in forces prediction.</code>
<code>rel_std_tolerance * hyps[-1] = cutoff value</code> for <strong>the criteria of adding atoms to training set</strong>.</li>
<li><code>abs_std_tolerance</code>: similar to <code>rel_std_tolerance</code>, but it&rsquo;s a absolute value and not respect to dataset.
default is 0. <strong>WTF?</strong></li>
</ul>
</li>
<li>Pre-Training arguments</li>
</ul>
<p>For using reasonable hyperparameters, and prevent test db for low diversity of atomic configuration.</p>
<ul>
<li><code>pre_train_on_skips</code>: Slice the input frames by <code>frames[::pre_train_on_skips]</code></li>
<li>The results wil be stored in <code>gp_from_aimd.out.</code></li>
<li>The resultant model will be stored in a <code>.json</code> file format which can be later loaded using the <code>GaussianProcess.from_dict()</code> method.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> flare.gp_from_aimd <span style=color:#f92672>import</span> TrajectoryTrainer
TT <span style=color:#f92672>=</span> TrajectoryTrainer(frames<span style=color:#f92672>=</span>trajectory,
                    gp <span style=color:#f92672>=</span> gp,
                    rel_std_tolerance <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>,
                    abs_std_tolerance<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,
                    pre_train_on_skips<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>)
TT<span style=color:#f92672>.</span>run()
print(<span style=color:#e6db74>&#34;Done!&#34;</span>)
</code></pre></div><h1 ref=4-on-the-fly-training-using-ase>4. On-the-fly training using ASE</h1><a class=anchor id=4-on-the-fly-training-using-ase></a>
<blockquote>
<p>&ldquo;On the fly used to describe sth that is being changed while the process that the change affects is ongoing.</p>
</blockquote>
<blockquote>
<p>&ldquo;In Colloquial used to mean sth that was not planned ahead, or changes while execution of same activity&rdquo;</p>
</blockquote>
<blockquote>
<p>————wikipedia</p>
</blockquote>
<h3 ref=1-set-up-supercell-with-ase>1. Set up supercell with ASE</h3><a class=anchor id=1-set-up-supercell-with-ase></a>
<h3 ref=2-set-up-flare-calculator>2. Set up FLARE calculator</h3><a class=anchor id=2-set-up-flare-calculator></a>
<p>set up Gaussian process model as introduced before</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> flare.gp <span style=color:#f92672>import</span> GaussianProcess
<span style=color:#f92672>from</span> flare.utils.parameter_helper <span style=color:#f92672>import</span> ParameterHelper

<span style=color:#75715e># set up GP hyperparameters</span>
kernels <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;twobody&#39;</span>, <span style=color:#e6db74>&#39;threebody&#39;</span>] <span style=color:#75715e># use 2+3 body kernel</span>
parameters <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;cutoff_twobody&#39;</span>: <span style=color:#ae81ff>5.0</span>,
              <span style=color:#e6db74>&#39;cutoff_threebody&#39;</span>: <span style=color:#ae81ff>3.5</span>}
pm <span style=color:#f92672>=</span> ParameterHelper(
    kernels <span style=color:#f92672>=</span> kernels,
    random <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>,
    parameters<span style=color:#f92672>=</span>parameters
)

hm <span style=color:#f92672>=</span> pm<span style=color:#f92672>.</span>as_dict()
hyps <span style=color:#f92672>=</span> hm[<span style=color:#e6db74>&#39;hyps&#39;</span>]
cut <span style=color:#f92672>=</span> hm[<span style=color:#e6db74>&#39;cutoffs&#39;</span>]
print(<span style=color:#e6db74>&#39;hyps&#39;</span>, hyps)

gp_model <span style=color:#f92672>=</span> GaussianProcess(
    kernels <span style=color:#f92672>=</span> kernels,
    component <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;mc&#39;</span>, <span style=color:#75715e># If you are using ASE, please set to &#34;mc&#34; no matter for single-component or multi-component</span>
    hyps <span style=color:#f92672>=</span> hyps,
    cutoffs <span style=color:#f92672>=</span> cut,
    hyp_labels <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;sig2&#39;</span>,<span style=color:#e6db74>&#39;ls2&#39;</span>,<span style=color:#e6db74>&#39;sig3&#39;</span>,<span style=color:#e6db74>&#39;ls3&#39;</span>,<span style=color:#e6db74>&#39;noise&#39;</span>],
    opt_algorithm <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;L-BFGS-B&#39;</span>,
    n_cpus <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
)
</code></pre></div><h3 ref=3-set-up-dft-calculator>3. Set up DFT calculator</h3><a class=anchor id=3-set-up-dft-calculator></a>
<ul>
<li>we can use ASE calculators here</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>for</span> ase<span style=color:#f92672>.</span>calculators<span style=color:#f92672>.</span>aims <span style=color:#f92672>import</span> Aims
<span style=color:#f92672>from</span> ase.calculator.dftb <span style=color:#f92672>import</span> Dftb
dft_calc <span style=color:#f92672>=</span> Aims()
</code></pre></div><h3 ref=4-set-up-on-the-fly-md-engine>4. Set up On-The-Fly MD engine</h3><a class=anchor id=4-set-up-on-the-fly-md-engine></a>
<ol>
<li>Setup MD arguments</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> ase <span style=color:#f92672>import</span> units
<span style=color:#f92672>from</span> ase.md.velocitydistribution <span style=color:#f92672>import</span> (MaxwellBoltzmannDistribution,
                                         Stationary, ZeroRotation)

temperature <span style=color:#f92672>=</span> <span style=color:#ae81ff>500</span>
MaxwellBoltzmannDistribution(super_cell, temperature <span style=color:#f92672>*</span> units<span style=color:#f92672>.</span>kB)
Stationary(super_cell)  <span style=color:#75715e># zero linear momentum</span>
ZeroRotation(super_cell)  <span style=color:#75715e># zero angular momentum</span>

md_engine <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;VelocityVerlet&#39;</span>
md_kwargs <span style=color:#f92672>=</span> {}
</code></pre></div><ol start=2>
<li>Set up otf parameters</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>otf_params <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;init_atoms&#39;</span>: [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>],
              <span style=color:#e6db74>&#39;output_name&#39;</span>: <span style=color:#e6db74>&#39;otf&#39;</span>,
              <span style=color:#e6db74>&#39;std_tolerance_factor&#39;</span>: <span style=color:#ae81ff>2</span>,
              <span style=color:#e6db74>&#39;max_atoms_added&#39;</span> : <span style=color:#ae81ff>4</span>,
              <span style=color:#e6db74>&#39;freeze_hyps&#39;</span>: <span style=color:#ae81ff>10</span>,
              <span style=color:#e6db74>&#39;write_model&#39;</span>: <span style=color:#ae81ff>3</span>} <span style=color:#75715e># If you will probably resume the training, please set to 3</span>
</code></pre></div><ol start=3>
<li>Set up <code>ASE_OTF</code> training engine, and run</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> flare.ase.otf <span style=color:#f92672>import</span> ASE_OTF
test_otf <span style=color:#f92672>=</span> ASE_OTF(super_cell,
                   timestep <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> units<span style=color:#f92672>.</span>fs,
                   number_of_steps <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>,
                   dft_calc <span style=color:#f92672>=</span> lj_calc,
                   md_engine <span style=color:#f92672>=</span> md_engine,
                   md_kwargs <span style=color:#f92672>=</span> md_kwargs,
                   <span style=color:#f92672>**</span>otf_params)

test_otf<span style=color:#f92672>.</span>run()
</code></pre></div><ol start=4>
<li>check <code>otf.out</code> file</li>
</ol>
</div>
<div class=chevrons>
</div>
</section>
<section class=right-menu>
<div class=TableOfContents>
<label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What's on this page</label>
<nav>
<ul>
<li><a href=/mengnancui/flare/></a></li>
</ul>
</nav>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#1-objectives->1. Objectives:** **</a></li>
<li><a href=#2-installation>2. Installation</a></li>
<li><a href=#3-first-trial>3. First trial</a></li>
<li><a href=#4-learning-curve>4. Learning curve</a></li>
<li><a href=#5-toward-large-scale-applications-pdag>5. Toward large scale applications: Pd/Ag</a></li>
</ul>
</li>
</ul>
<ul>
<li>
<ul>
<li><a href=#1-date-from-ase>1. Date from ase</a></li>
</ul>
</li>
</ul>
<ul>
<li>
<ul>
<li><a href=#1-setting-up-a-gaussain-process-object>1. Setting up a Gaussain Process Object</a></li>
<li><a href=#2-extracting-the-frames-from-a-previous-aimd-runoptional>2. Extracting the Frames from a previous AIMD run(Optional)</a></li>
<li><a href=#3-training-your-gaussian-process>3. Training your Gaussian Process</a></li>
</ul>
</li>
</ul>
<ul>
<li>
<ul>
<li><a href=#1-set-up-supercell-with-ase>1. Set up supercell with ASE</a></li>
<li><a href=#2-set-up-flare-calculator>2. Set up FLARE calculator</a></li>
<li><a href=#3-set-up-dft-calculator>3. Set up DFT calculator</a></li>
<li><a href=#4-set-up-on-the-fly-md-engine>4. Set up On-The-Fly MD engine</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div class=Actions>
<nav>
<ul>
</ul>
</nav>
</div>
</section>
</article>
<footer>
Create a content/_layout/footer/_index.md file to customize the footer content !
</footer>
</body>
</html>